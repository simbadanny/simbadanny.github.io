<!DOCTYPE html>
<html>

<head>
    <title>CRUD Bryan Sanchez</title>
</head>

<body>
    <h1>CRUD Bryan Sanchez</h1>
    <form id="crud-form">
        <label for="nombre">Nombre:</label>
        <input type="text" id="nombre" required>
        <label for="apellido">Apellido:</label>
        <input type="text" id="apellido" required>
        <label for="cedula">Cedula:</label>
        <input type="text" id="cedula" required>
        <label for="email">Email:</label>
        <input type="email" id="email" required>
        <label for="fecha">Fecha:</label>
        <input type="date" id="fecha" required>
        <button type="button" onclick="crearOActualizarRegistro()">Guardar</button>
        <button type="button" onclick="limpiarFormulario()">Limpiar</button>
    </form>

    <br>

    <table border="1">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Cedula</th>
                <th>Email</th>
                <th>Fecha</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="table-body">
            <!-- Registros se mostrarán aquí -->
        </tbody>
    </table>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, update, remove, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

                    // Your web app's Firebase configuration
                    const firebaseConfig = {
              apiKey: "AIzaSyBMJsVpnbOwVOiVNbTZScZdet9qlGigDL0",
              authDomain: "conexion-8ec0d.firebaseapp.com",
              databaseURL: "https://conexion-8ec0d-default-rtdb.firebaseio.com",
              projectId: "conexion-8ec0d",
              storageBucket: "conexion-8ec0d.appspot.com",
              messagingSenderId: "679910299749",
              appId: "1:679910299749:web:9800b464879628b4850e8c"
            };


        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        const nombreInput = document.getElementById("nombre");
        const apellidoInput = document.getElementById("apellido");
        const cedulaInput = document.getElementById("cedula");
        const emailInput = document.getElementById("email");
        const fechaInput = document.getElementById("fecha");

        window.crearOActualizarRegistro = function () {
            const nombre = nombreInput.value;
            const apellido = apellidoInput.value;
            const cedula = cedulaInput.value;
            const email = emailInput.value;
            const fecha = fechaInput.value;

            if (nombre && apellido && cedula && email && fecha) {
                const cedulaExistente = document.getElementById("cedula-existente");

                if (cedulaExistente) {
                    actualizarRegistro(cedulaExistente.value);
                } else {
                    crearRegistro();
                }
            } else {
                alert("Todos los campos son obligatorios");
            }
        }

        function crearRegistro() {
            push(
                ref(database, 'Bryan_Sanchez'),
                {
                    name: nombreInput.value,
                    apellido: apellidoInput.value,
                    cedula: cedulaInput.value,
                    email: emailInput.value,
                    date: fechaInput.value
                }
            );

            limpiarFormulario();
        }

        window.actualizarRegistro = function (cedula) {
            const updates = {};
            updates['/Bryan_Sanchez/' + cedula] = {
                name: nombreInput.value,
                apellido: apellidoInput.value,
                cedula: cedulaInput.value,
                email: emailInput.value,
                date: fechaInput.value
            };

            update(ref(database), updates);

            limpiarFormulario();
        }

        window.eliminarRegistro = function (cedula) {
            remove(ref(database, 'Bryan_Sanchez/' + cedula));

            limpiarFormulario();
        }

        onValue(ref(database, 'Bryan_Sanchez'), (snapshot) => {
            const tableBody = document.getElementById('table-body');
            tableBody.innerHTML = "";

            snapshot.forEach((childSnapshot) => {
                const data = childSnapshot.val();
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${data.name}</td>
                    <td>${data.apellido}</td>
                    <td>${data.cedula}</td>
                    <td>${data.email}</td>
                    <td>${data.date}</td>
                    <td>
                        <button onclick="llenarFormulario('${data.name}', '${data.apellido}', '${data.cedula}', '${data.email}', '${data.date}')">Actualizar</button>
                        <button onclick="eliminarRegistro('${data.cedula}')">Eliminar</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        });

        window.llenarFormulario = function (nombre, apellido, cedula, email, fecha) {
            nombreInput.value = nombre;
            apellidoInput.value = apellido;
            cedulaInput.value = cedula;
            emailInput.value = email;
            fechaInput.value = fecha;

            const crearButton = document.querySelector("button[onclick='crearOActualizarRegistro()']");
            crearButton.textContent = "Actualizar";
            crearButton.onclick = function () {
                actualizarRegistro(cedula);
            };
        }

        function limpiarFormulario() {
            nombreInput.value = "";
            apellidoInput.value = "";
            cedulaInput.value = "";
            emailInput.value = "";
            fechaInput.value = "";

            const crearButton = document.querySelector("button[onclick='crearOActualizarRegistro()']");
            crearButton.textContent = "Guardar";
            crearButton.onclick = function () {
                crearOActualizarRegistro();
            };
        }
    </script>
</body>

</html>