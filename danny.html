<html>

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/estilo.css">
</head>

<body>
    <h1>Ingrese sus Datos</h1>
    <form id="crud-form">
        <div class="row mb-3">
            <div class="col">
                <label for="nombre" class="form-label">Nombre:</label>
                <input type="text" class="form-control" id="nombre">
            </div>
            <div class="col">
                <label for="apellido" class="form-label">Apellido:</label>
                <input type="text" class="form-control" id="apellido">
            </div>
        </div>
        <div class="row mb-3">
            <div class="col">
                <label for="edad" class="form-label">Edad:</label>
                <input type="number" class="form-control" id="edad">
            </div>
            <div class="col">
                <label for="cedula" class="form-label">Cedula:</label>
                <input type="number" class="form-control" id="cedula">
            </div>
        </div>
        <button type="button" class="btn btn-primary" onclick="crearRegistro()">Crear</button>
    </form>

    <table class="table table-bordered">
        <thead class="thead-dark">
            <tr>
                <th>Nombre</th>
                <th>Apellido</th>
                <th>Edad</th>
                <th>Cedula</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody id="registros-list"></tbody>
    </table>

    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, onValue, update, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBja1INkBV0jcirLwx4eNilrZcREPibiY8",
            authDomain: "musica-afa86.firebaseapp.com",
            databaseURL: "https://musica-afa86-default-rtdb.firebaseio.com",
            projectId: "musica-afa86",
            storageBucket: "musica-afa86.appspot.com",
            messagingSenderId: "275776899168",
            appId: "1:275776899168:web:eb2bfea603cc0fb25f5b05"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        window.crearRegistro = function () {
            const nombre = document.getElementById("nombre").value;
            const apellido = document.getElementById("apellido").value;
            const edad = document.getElementById("edad").value;
            const cedula = document.getElementById("cedula").value;

            push(
                ref(database, 'Simba Danny'),
                {
                    name: nombre,
                    last_name: apellido,
                    age: edad,
                    cedula: cedula
                }
            );
        }

        // Leer registros al cargar la pÃ¡gina
        onValue(ref(database, 'Simba Danny'), (snapshot) => {
            const registrosList = document.getElementById('registros-list');
            registrosList.innerHTML = '';

            snapshot.forEach((childSnapshot) => {
                const key = childSnapshot.key; // Get the key of the record
                const registro = childSnapshot.val();

                // Create HTML row for each record
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${registro.name}</td>
                    <td>${registro.last_name}</td>
                    <td>${registro.age}</td>
                    <td>${registro.cedula}</td>
                    <td>
                        <button type="button" class="btn btn-warning btn-actualizar" onclick="actualizarRegistro('${childSnapshot.key}', '${registro.name}', '${registro.last_name}', '${registro.age}', '${registro.cedula}')">Actualizar</button>
                        <button type="button" class="btn btn-danger btn-eliminar" onclick="eliminarRegistro('${childSnapshot.key}')">Eliminar</button>
                    </td>
                `;

                    // Append the row to the table
                    registrosList.appendChild(row);         
                });
            });

            window.actualizarRegistro = function (key, nombre, apellido, edad, cedula) {
                update(ref(database, `Simba Danny/${key}`), {
                name: nombre,
                last_name: apellido,
                age: edad,
                cedula: cedula
            });
        }

        window.eliminarRegistro = function (key) {
            remove(ref(database, `Simba Danny/${key}`));
        }
    </script>
</body>

</html>
